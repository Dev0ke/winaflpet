{{define "content"}}
<form id="editJob" method="POST" enctype="multipart/form-data">

  <fieldset class="row mb-3">
    <legend>General settings</legend>

    <div class="row ms-0">
      <div class="col-md">
        <label for="agent" class="col-md col-form-label">Agent</label>
        <div class="col-md">
          <select class="form-select" id="aid" name="aid" required>
            {{$ := .}}
            {{range .agents}}
              <option value="{{ .ID }}" {{if eq $.job.AgentID .ID }}selected{{end}}>{{.Name}}</option>
            {{end}}
          </select>
          <small id="agentHelp" class="form-text text-muted">Specify the remote agent</small>
        </div>
      </div>

      <div class="col-md">
        <label for="cores" class="col-md col-form-label">CPU cores</label>
        <div class="col-md">
          <select class="form-select" id="cores" name="cores">
          {{range seq 40}}
            <option value="{{.}}" {{if (eq $.job.Cores .) }}selected{{end}}>{{.}}</option>
          {{end}}
          </select>
          <small id="coresHelp" class="form-text text-muted">Enable distributed mode by increasing CPU cores</small>
        </div>
      </div>

      <div class="col-md">
          <label for="name" class="col-md col-form-label">Name</label>
          <div class="col-md">
            <input type="text" class="form-control" name="name" id="name" aria-describedby="nameHelp" value="{{.job.Name}}">
            <small id="nameHelp" class="form-text text-muted">Short name of the new job</small>
          </div>
      </div>

      <div class="col-md">
        <label for="banner" class="col-md col-form-label">Banner</label>
        <div class="col-md">
          <input type="text" class="form-control" name="banner" id="banner" aria-describedby="bannerHelp" value="{{.job.Banner}}">
          <small id="bannerHelp" class="form-text text-muted">Short text banner to show on the screen</small>
        </div>
      </div>
    </div>

    <div class="row ms-0">
      <div class="col-md">
        <label for="desc" class="col-md col-form-label">Description</label>
        <div class="col-md">
          <input type="text" class="form-control" name="desc" id="desc" aria-describedby="descHelp" value="{{.job.Desc}}">
          <small id="descHelp" class="form-text text-muted">Short description of the job</small>
        </div>
      </div>
    </div>

  </fieldset>

  <fieldset class="row mb-3">
    <legend>Tool locations</legend>
    <div class="row ms-0">

      <div class="col-md">
        <label for="aflDir" class="col-md col-form-label">AFL directory</label>
        <div class="col-md">
          <input type="text" class="form-control" name="afl_dir" id="aflDir" aria-describedby="aflDirHelp" value="{{.job.AFLDir}}">
          <small id="aflDirHelp" class="form-text text-muted">AFL directory on the remote machine</small>
        </div>
      </div>

      <div class="col-md">
        <label for="drioDir" class="col-md col-form-label">DynamorIO directory</label>
        <div class="col-md">
          <input type="text" class="form-control" name="drio_dir" id="drioDir" aria-describedby="drioDirHelp" value="{{.job.DrioDir}}">
          <small id="drioDirHelp" class="form-text text-muted">DynamorIO directory on the remote machine</small>
        </div>
      </div>

      <div class="col-md">
        <label for="pyDir" class="col-md col-form-label">Python directory</label>
        <div class="col-md">
          <input type="text" class="form-control" name="py_dir" id="pyDir" aria-describedby="pyDirHelp" value="{{.job.PyDir}}">
          <small id="pyDirHelp" class="form-text text-muted">Python directory on the remote machine</small>
        </div>
      </div>

      <div class="col-md">
        <label for="bugidDir" class="col-md col-form-label">BugId directory</label>
        <div class="col-md">
          <input type="text" class="form-control" name="bugid_dir" id="bugidDir" aria-describedby="bugidDirHelp" value="{{.job.BugIdDir}}">
          <small id="bugidDirHelp" class="form-text text-muted">BugId directory on the remote machine</small>
        </div>
      </div>

    </div>
  </fieldset>

  <fieldset class="row mb-3">
    <legend>Basic parameters</legend>
    <div class="row ms-0">

      <div class="col-md">
        <label for="input" class="col-md col-form-label">Input</label>
        <div class="col-md">
          <input type="text" class="form-control" name="input" id="input" aria-describedby="inputHelp" value="{{.job.Input}}">
          <small id="inputHelp" class="form-text text-muted">Input directory with test cases</small>
        </div>
      </div>

      <div class="col-md">
        <label for="output" class="col-md col-form-label">Output</label>
        <div class="col-md">
          <input type="text" class="form-control" name="output" id="output" aria-describedby="outputHelp" value="{{.job.Output}}">
          <small id="outputHelp" class="form-text text-muted">Output directory for findings</small>
        </div>
      </div>

      <div class="col-md">
        <label for="delivMode" class="col-md col-form-label">Delivery</label>
        <div class="col-md">
          <select class="form-select" name="deliv_mode" id="delivMode">
            <option value="" {{if (eq .job.DelivMode "") }}selected{{end}}>File</option>
            <option value="sm" {{if (eq .job.DelivMode "sm") }}selected{{end}}>Shared memory</option>
          </select>
          <small id="delivModeHelp" class="form-text text-muted">Sample delivery mode</small>
        </div>
      </div>

      <div class="col-md">
        <label for="timeout" class="col-md col-form-label">Timeout</label>
        <div class="col-md">
          <input type="number" class="form-control" name="timeout" id="timeout" aria-describedby="timeoutHelp" value="{{.job.Timeout}}" required>
          <small id="timeoutHelp" class="form-number">Timeout for each run</small>
        </div>
      </div>

    </div>

    <div class="row ms-0">

      <div class="col-md">
        <label for="attachLib" class="col-md col-form-label">Attach library</label>
        <div class="col-md">
          <input type="text" class="form-control" name="attach_lib" id="attachLib" aria-describedby="attachLibHelp" value="{{.job.AttachLib}}">
          <small id="attachLibHelp" class="form-text text-muted">Library identifying a unique process to attach to</small>
        </div>
      </div>

      <div class="col-md">
        <label for="customLib" class="col-md col-form-label">Custom library</label>
        <div class="col-md">
          <input type="text" class="form-control" name="custom_lib" id="customLib" aria-describedby="customLibHelp" value="{{.job.CustomLib}}">
          <small id="customLibHelp" class="form-text text-muted">Path to user-defined library for custom test cases processing</small>
        </div>
      </div>

      <div class="col-md">
        <label for="extrasDir" class="col-md col-form-label">Extras directory</label>
        <div class="col-md">
          <input type="text" class="form-control" name="extras_dir" id="extrasDir" aria-describedby="extrasDirHelp" value="{{.job.ExtrasDir}}">
          <small id="extrasDirHelp" class="form-text text-muted">Optional fuzzer dictionary</small>
        </div>
      </div>

      <div class="col-md">
        <label for="memoryLimit" class="col-md col-form-label">Memory limit</label>
        <div class="col-md">
          <input type="text" class="form-control" name="memory_limit" id="memoryLimit" aria-describedby="memoryLimitHelp" value="{{.job.MemoryLimit}}">
          <small id="memoryLimitHelp" class="form-text text-muted">Memory limit for the target process</small>
        </div>
      </div>

    </div>

    <div class="row ms-0 mt-2">
      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="afl_f_mode" id="aflFMode" value="1" {{if eq .job.AFLFMode 1}}checked{{end}}>
            <label class="form-check-label" for="aflFMode">Enable AFL <code>-f</code> file mode</label>
          </div>
        </div>
      </div>

      <div class="col-md">
        <label for="aflFDir" class="col-md col-form-label">AFL <code>-f</code> directory</label>
        <div class="col-md">
          <input type="text" class="form-control" name="afl_f_dir" id="aflFDir" aria-describedby="aflFDirHelp" value="{{.job.AFLFDir}}">
          <small id="aflFDirHelp" class="form-text text-muted">Directory on the remote agent where the per-core input file will be created.</small>
        </div>
      </div>

      <div class="col-md">
        <label for="aflFSuffix" class="col-md col-form-label">AFL <code>-f</code> suffix</label>
        <div class="col-md">
          <input type="text" class="form-control" name="afl_f_suffix" id="aflFSuffix" aria-describedby="aflFSuffixHelp" value="{{.job.AFLFSuffix}}">
          <small id="aflFSuffixHelp" class="form-text text-muted">Suffix appended to a random 4-char filename (e.g. <code>.ppt</code>).</small>
        </div>
      </div>
    </div>

    <div class="row ms-0 mt-2">
      <div class="col-md-12">
        <label for="basicExtraArgs" class="col-md col-form-label">Basic parameters: extra args (before first <code>--</code>)</label>
        <div class="col-md">
          <input type="text" class="form-control" name="basic_extra_args" id="basicExtraArgs" aria-describedby="basicExtraArgsHelp" value="{{.job.BasicExtraArgs}}">
          <small id="basicExtraArgsHelp" class="form-text text-muted">Optional. Appended to the afl-fuzz command line right before the first <code>--</code>.</small>
        </div>
      </div>
    </div>

    <div class="row ms-0">

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="dirty_mode" id="dirtyMode" value="1" {{ if eq .job.DirtyMode 1}}checked{{end}}>
            <label class="form-check-label" for="dirtyMode">Quick & dirty mode</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="dumb_mode" id="dumbMode" value="1" {{ if eq .job.DumbMode 1}}checked{{end}}>
            <label class="form-check-label" for="dumbMode">Without instrumentation</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="crash_mode" id="crashMode" value="1" {{ if eq .job.CrashMode 1}}checked{{end}}>
            <label class="form-check-label" for="crashMode">Crash exploration mode</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="persist_cache" id="persistCache" value="1" {{if eq .job.PersistCache 1}}checked{{end}}>
            <label class="form-check-label" for="persistCache">Persist DynamoRIO cache</label>
          </div>
        </div>
      </div>

    </div>

    <div class="row ms-0">

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="expert_mode" id="expertMode" value="1" {{ if eq .job.ExpertMode 1}}checked{{end}}>
            <label class="form-check-label" for="expertMode">Expert mode</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="variable_mode" id="variableMode" value="1" {{ if eq .job.VariableMode 1}}checked{{end}}>
            <label class="form-check-label" for="variableMode">Variable mode</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="sequential_mode" id="sequentialMode" value="1" {{ if eq .job.SequentialMode 1}}checked{{end}}>
            <label class="form-check-label" for="sequentialMode">Sequential mode</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="bug_bucket" id="bugBucket" value="1" {{ if eq .job.BugBucket 1}}checked{{end}}>
            <label class="form-check-label" for="bugBucket">Bug bucket</label>
          </div>
        </div>
      </div>

    </div>
  </fieldset>

  <fieldset class="row mb-3">
    <legend>Environment variables</legend>

    <div class="row ms-0">

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="no_affinity" id="noAffinity" value="1" {{if eq .job.NoAffinity 1}}checked{{end}}>
            <label class="form-check-label" for="noAffinity">No affinity</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="skip_crashes" id="skipCrashes" value="1" {{if eq .job.SkipCrashes 1}}checked{{end}}>
            <label class="form-check-label" for="skipCrashes">Skip crashes</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="shuffle_queue" id="shuffleQueue" value="1" {{if eq .job.ShuffleQueue 1}}checked{{end}}>
            <label class="form-check-label" for="shuffleQueue">Shuffle queue</label>
          </div>
        </div>
      </div>

      <div class="col-3">
        <div class="form-check form-switch">
          <div class="col">
            <input class="form-check-input" type="checkbox" name="autoresume" id="autoresume" value="1" {{ if eq .job.Autoresume 1}}checked{{end}}>
            <label class="form-check-label" for="autoresume">Autoresume</label>
          </div>
        </div>
      </div>

    </div>

    <div class="row ms-0 mt-2">
      <div class="col-md">
        <label for="envVars" class="col-md col-form-label">Custom env vars</label>
        <div class="col-md">
          <textarea class="form-control" name="env_vars" id="envVars" rows="4" aria-describedby="envVarsHelp" placeholder="AFL_FAST_CAL=1&#10;AFL_DISABLE_TRIM=1&#10;AFL_SKIP_BYTES=512">{{.job.EnvVars}}</textarea>
          <small id="envVarsHelp" class="form-text text-muted">One KEY=VALUE per line. These will be added to the remote process environment.</small>
        </div>
      </div>
    </div>

  </fieldset>

  <fieldset class="row mb-3">
    <legend>Instrumentation settings</legend>

    <div class="row ms-0">

      <div class="col-md">
        <label for="instMode" class="col-md col-form-label">Instrumentation mode</label>
        <div class="col-md">
          <select class="form-select" name="inst_mode" id="instMode">
            <option value="DynamoRIO" {{if (eq .job.InstMode "DynamoRIO") }}selected{{end}}>DynamoRIO</option>
            <option value="TinyInst" {{if (eq .job.InstMode "TinyInst") }}selected{{end}}>TinyInst</option>
          </select>
          <small id="instModeHelp" class="form-text text-muted">Tool used to instrument the target</small>
        </div>
      </div>

      <div class="col-md">
        <label for="coverageModule" class="col-md col-form-label">Coverage module(s)</label>
        <div class="col-md">
          <textarea class="form-control" name="cov_module" id="coverageModule" rows="2" aria-describedby="coverageModuleHelp" placeholder="module1.dll&#10;module2.dll">{{.job.CoverageModule}}</textarea>
          <small id="coverageModuleHelp" class="form-text text-muted">Module(s) to collect coverage for. One per line (or comma-separated).</small>
        </div>
      </div>

      <div class="col-md">
        <label for="instrumentTransitive" class="col-md col-form-label">Instrument transitive module(s)</label>
        <div class="col-md">
          <textarea class="form-control" name="instrument_transitive" id="instrumentTransitive" rows="2" aria-describedby="instrumentTransitiveHelp" placeholder="test.dll">{{.job.InstrumentTransitive}}</textarea>
          <small id="instrumentTransitiveHelp" class="form-text text-muted">TinyInst only. One module per line (or comma-separated).</small>
        </div>
      </div>

      <div class="col-md">
        <label for="coverageType" class="col-md col-form-label">Coverage type</label>
        <div class="col-md">
          <select class="form-select" name="cov_type" id="coverageType">
            <option value="bb" {{if (eq .job.CoverageType "bb") }}selected{{end}}>Basic block</option>
            <option value="edge" {{if (eq .job.CoverageType "edge") }}selected{{end}}>Edge</option>
          </select>
          <small id="coverageTypeHelp" class="form-text text-muted">The type of coverage being recorded</small>
        </div>
      </div>

      <div class="col-md">
        <label for="fuzzIter" class="col-md col-form-label">Fuzz iterations</label>
        <div class="col-md">
          <input type="number" class="form-control" name="fuzz_iter" id="fuzzIter" aria-describedby="fuzzIterHelp" value="{{.job.FuzzIter}}" required>
          <small id="fuzzIterHelp" class="form-number">Fuzzing iterations to perform</small>
        </div>
      </div>

      <div class="col-md">
        <label class="col-md col-form-label">Options</label>
        <div class="col-md">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="ignore_hitcount" id="ignoreHitcount" value="1" {{if eq .job.IgnoreHitcount 1}}checked{{end}}>
            <label class="form-check-label" for="ignoreHitcount">Ignore hitcount</label>
          </div>
          <div class="form-check form-switch mt-1">
            <input class="form-check-input" type="checkbox" name="drio_persistence_in_app" id="drioPersistenceInApp" value="1" {{if eq .job.DrioPersistenceInApp 1}}checked{{end}}>
            <label class="form-check-label" for="drioPersistenceInApp">DynamoRIO: <code>-persistence_mode in_app</code></label>
          </div>
          <div class="form-check form-switch mt-1">
            <input class="form-check-input" type="checkbox" name="ti_persist" id="tinyPersist" value="1" {{if eq .job.TinyPersist 1}}checked{{end}}>
            <label class="form-check-label" for="tinyPersist">TinyInst: <code>-persist</code></label>
          </div>
          <div class="form-check form-switch mt-1">
            <input class="form-check-input" type="checkbox" name="ti_loop" id="tinyLoop" value="1" {{if eq .job.TinyLoop 1}}checked{{end}}>
            <label class="form-check-label" for="tinyLoop">TinyInst: <code>-loop</code></label>
          </div>
          <small class="form-text text-muted"></small>
        </div>
      </div>
    </div>

    <div class="row ms-0 mt-2">
      <div class="col-md-12">
        <label for="instExtraArgs" class="col-md col-form-label">Instrumentation settings: extra args (before second <code>--</code>)</label>
        <div class="col-md">
          <input type="text" class="form-control" name="inst_extra_args" id="instExtraArgs" aria-describedby="instExtraArgsHelp" value="{{.job.InstExtraArgs}}">
          <small id="instExtraArgsHelp" class="form-text text-muted">Optional. Appended right before the second <code>--</code> (i.e. before launching the target executable).</small>
        </div>
      </div>
    </div>

    <div class="row ms-0">
      <div class="col-md">
        <label for="targetModule" class="col-md col-form-label">Target module</label>
        <div class="col-md">
          <input type="text" class="form-control" name="target_module" id="targetModule" aria-describedby="targetModuleHelp" value="{{.job.TargetModule}}">
          <small id="targetModuleHelp" class="form-text text-muted">Module with target function to fuzz</small>
        </div>
      </div>

      <div class="col-md">
        <label for="targetMethod" class="col-md col-form-label">Target method</label>
        <div class="col-md">
          <input type="text" class="form-control" name="target_method" id="targetMethod" aria-describedby="targetMethodHelp" value="{{.job.TargetMethod}}">
          <small id="targetMethodHelp" class="form-text text-muted">Name of the method to fuzz</small>
        </div>
      </div>

      <div class="col-md">
        <label for="targetOffset" class="col-md col-form-label">Target offset</label>
        <div class="col-md">
          <input type="text" class="form-control" name="target_offset" id="targetOffset" aria-describedby="targetOffsetHelp" value="{{.job.TargetOffset}}">
          <small id="targetOffsetHelp" class="form-text text-muted">Offset to target function</small>
        </div>
      </div>

      <div class="col-md">
        <label for="targetNArgs" class="col-md col-form-label">Target argument count</label>
        <div class="col-md">
          <input type="number" class="form-control" name="target_nargs" id="targetNArgs" aria-describedby="targetNArgsHelp" value="{{.job.TargetNArgs}}" required>
          <small id="targetNAargsHelp" class="form-number">Number of arguments the fuzzed method takes</small>
        </div>
      </div>

    </div>
  </fieldset>

  <fieldset class="row mb-3">
    <legend>Target application</legend>

    <div class="row ms-0">

      <div class="col-md-9">
        <label for="targetApp" class="col-md col-form-label">Target application command line</label>
        <div class="col-md">
          <input type="text" class="form-control" name="target_app" id="targetApp" aria-describedby="targetAppHelp" value="{{.job.TargetApp}}">
          <small id="targetAppHelp" class="form-text text-muted">Target application or harness to execute for fuzzing (e.g. harness.exe)</small>
        </div>
      </div>

      <div class="col-md">
        <label for="targetArch" class="col-md col-form-label">Architecture</label>
        <div class="col-md">
          <select class="form-select" name="target_arch" id="targetArch">
            <option value="x64" {{if (eq .job.TargetArch "x64") }}selected{{end}}>x64</option>
            <option value="x86" {{if (eq .job.TargetArch "x86") }}selected{{end}}>x86</option>

          </select>
          <small id="targetArchHelp" class="form-text text-muted">Target architecture</small>
        </div>
      </div>

    </div>

    <div class="row ms-0 mt-2">
      <div class="col-md-12">
        <label for="targetArgs" class="col-md col-form-label">Target arguments (template)</label>
        <div class="col-md">
          <input type="text" class="form-control" name="target_args" id="targetArgs" aria-describedby="targetArgsHelp" value="{{.job.TargetArgs}}">
          <small id="targetArgsHelp" class="form-text text-muted">Optional. If set, this overrides the args from the command line above. When AFL <code>-f</code> mode is enabled, <code>@@</code> (and <code>@@x</code>) will be replaced with the generated absolute file path (and path + suffix).</small>
        </div>
      </div>
    </div>
  </fieldset>

  <button type="submit" class="btn btn-primary">Submit</button>
</form>
{{end}}
